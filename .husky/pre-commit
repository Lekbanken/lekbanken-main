#!/usr/bin/env pwsh
# Husky pre-commit hook f√∂r type checking

Write-Host "üîç Running pre-commit checks..." -ForegroundColor Cyan

# Run type check
Write-Host "`nüìù Type checking..." -ForegroundColor Yellow
npm run type-check
$typeCheckResult = $LASTEXITCODE

if ($typeCheckResult -ne 0) {
    Write-Host "‚ùå Type check failed!" -ForegroundColor Red
    exit 1
}

# Check for 'as any' in staged files
Write-Host "`nüîé Checking for 'as any' in staged files..." -ForegroundColor Yellow
$stagedFiles = git diff --cached --name-only --diff-filter=ACM | Where-Object { $_ -match "\.(ts|tsx)$" -and $_ -notmatch "types/supabase.ts" }

$foundAny = $false
foreach ($file in $stagedFiles) {
    if (Test-Path $file) {
        $content = Get-Content $file -Raw
        if ($content -match "as any") {
            if (-not $foundAny) {
                Write-Host "‚ö†Ô∏è  Warning: 'as any' found in staged files:" -ForegroundColor Yellow
                $foundAny = $true
            }
            Write-Host "   - $file" -ForegroundColor Yellow
        }
    }
}

if ($foundAny) {
    Write-Host "`n‚ö†Ô∏è  Please ensure types are properly defined before committing" -ForegroundColor Yellow
    Write-Host "   Consider regenerating types if schema has changed:" -ForegroundColor Gray
    Write-Host "   npm run db:types:remote" -ForegroundColor Gray
    # Inte exit 1 h√§r - bara varning
}

Write-Host "`n‚úÖ Pre-commit checks passed!" -ForegroundColor Green
exit 0
